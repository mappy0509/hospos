HOSPOS 開発・引き継ぎドキュメント (v1.5)
🤖 AI開発者への指示
あなたは現在、ホストクラブ専用POSシステム「HOSPOS」の開発を引き継ぐリードエンジニアです。 以下のプロジェクト概要、技術スタック、最新の進捗状況（v1.5）、および**「絶対的なルール」**を熟読し、文脈を完全に理解した上でサポートを行ってください。

1. プロジェクト概要
プロジェクト名: HOSPOS (Host Club POS System)

目的: ホストクラブの業務（接客、注文、会計、勤怠、給与、分析）を一元管理するSaaS型アプリケーション。

アーキテクチャ: マルチテナント型（1つのアプリで複数店舗が利用。データは店舗ごとに完全に分離）。

2. 技術スタック・開発環境
※重要：学習コストとデプロイの手軽さを優先し、以下の構成を厳守すること。

Frontend: HTML5, CSS3, Vanilla JavaScript (ES Modules)

禁止事項: React, Vue, TypeScript, Webpack/Viteなどのビルドツール使用は禁止。ブラウザで直接動く生のコードで記述する。

Backend / DB: Firebase (v12.6.0) via CDN

Authentication (Email/Password)

Firestore (NoSQL Database)

Design:

Admin (PC/Tablet/Mobile): サイドバーメニュー、ダッシュボード形式（★v1.5: 全ページ完全レスポンシブ対応完了）。

Cast (Smartphone): モバイルファースト、ボトムナビゲーション、片手操作UI。

Libraries (CDN):

FontAwesome (アイコン)

Chart.js (売上分析)

SortableJS (ドラッグ&ドロップ)

QRCode.js (管理者側QR生成)

html5-qrcode (キャスト側QR読み取り)

3. ディレクトリ構成 (v1.5 最新)
Plaintext

/ (root)
  ├── index.html (ログイン)
  ├── register.html (店舗新規登録)
  ├── cast-register.html (キャスト招待登録)
  ├── /admin (管理者・内勤用)
  │    ├── dashboard.html (★Update: スマホ対応・サイドバー開閉)
  │    ├── slips.html (★Update: スマホ対応・テーブルスクロール)
  │    ├── slip-detail.html (★Update: スマホ対応・縦積みレイアウト)
  │    ├── call-management.html (★Update: スマホ対応・グリッド調整)
  │    ├── shokai-control.html (★Update: スマホ対応)
  │    ├── products.html (★Update: スマホ対応・カテゴリ操作UI調整)
  │    ├── inventory.html (★Update: スマホ対応)
  │    ├── cast-list.html (★Update: スマホ対応)
  │    ├── attendance.html (★Update: スマホ対応・QR表示調整)
  │    ├── schedule.html (★Update: スマホ対応・コントロールパネル調整)
  │    ├── salary.html (★Update: スマホ対応・明細レイアウト調整)
  │    ├── customers.html (★Update: スマホ対応)
  │    ├── sales-analysis.html (★Update: スマホ対応・KPI表示調整)
  │    ├── ranking.html (★Update: スマホ対応)
  │    ├── daily-report.html (★Update: スマホ対応)
  │    └── settings.html (★Update: スマホ対応・フォーム最適化)
  ├── /cast (キャスト・ホスト用)
  │    ├── home.html (出勤/退勤・QRスキャン・お知らせ)
  │    ├── order.html (入店処理・相席)
  │    ├── menu.html (注文履歴確認・変更・キャンセル機能)
  │    ├── my-customers.html (担当顧客の売上・来店統計表示)
  │    └── profile.html (売上確認・設定)
  └── /assets
       ├── /css (style.css)
       └── /js
            ├── firebase-config.js (初期化設定)
            ├── utils.js (日付計算・営業日判定)
            └── salary-calculator.js (給与計算ロジッククラス)

4. データベース設計 (Firestore)
鉄の掟: 全てのデータは tenants/{tenantId}/ の配下に置くこと。

ルート: tenants (Collection) -> ドキュメント: {tenantId}

users: 従業員 (role, currentStatus, dailyWage 等)

products: 商品マスタ

inventory: 在庫マスタ

slips: 伝票

Fields: primaryCastId, primaryCastName, customerName, status('active'|'paid'|'void'), visitType, totalAmount, callBatchAmount

orders: 注文サブコレクション

customers: 顧客情報 (assignedCastId)

attendance: 打刻ログ (type: 'in'|'out', note: '自動退勤'等)

events: イベント・定休日

salaries: 給与明細

call_logs: コール履歴 (castId, role: 'main'|'sub')

counters: 日別連番管理

system: システム制御 (qr)

config: 店舗設定 (Map)

5. 実装済み機能と詳細ロジック (v1.5)
A. 伝票・注文管理 (Order Management)
柔軟な注文操作: 数量変更、削除、顧客名編集、没電機能。

金額表示: 税・サービス料・端数処理を含めた「予想総額」のリアルタイム表示。

B. 勤怠管理 (Attendance)
自動退勤: 日付変更線（Cutoff Hour）をまたいだ際の自動退勤処理ロジック。

C. データ一括登録・管理 (Bulk Operations)
スケジュール、商品メニューの一括登録（テキスト貼り付け）。

カテゴリ管理（リネーム・一括削除）。

D. 統計・分析 (Analytics)
顧客分析: 累計売上、来店回数、最終来店日の自動集計。

ランキング: 売上、指名本数に加え、マイクパフォーマンス回数ランキングを実装。

E. 管理画面のモバイル対応 (Mobile Responsiveness) ★New (v1.5)
全ページレスポンシブ化:

管理画面（/admin）の全15ファイルについて、スマートフォンサイズ（幅768px以下）での表示を最適化。

ハンバーガーメニュー: モバイル表示時にサイドバーを格納し、ボタンでオーバーレイ表示する機能を追加。

レイアウト調整:

グリッド表示（商品、テーブル等）をモバイルでは1列に変更。

テーブル（一覧表）に横スクロールを適用し、画面崩れを防止。

入力フォームや操作ボタンのサイズをタッチ操作向けに調整。

6. 開発における絶対ルール (Do's & Don'ts)
インデックスエラーの回避:

Firestoreの複合クエリ（where と orderBy の併用）は極力避ける。

対策: 基本的に where だけでデータを取得し、並び替え（Sort）や期間フィルタは JavaScript (Array.sort, filter) で行うこと。

1ページ1ファイル:

メンテナンス性を高めるため、SPAにはしない。HTMLファイルごとに完結させる。

Firebase SDK:

v12.6.0 (Modular Web SDK) を使用。

7. 次のタスク / 今後の展望
v1.5で管理画面のモバイル対応が完了し、現場でのスマホ運用が可能になりました。

売掛金管理の強化:

回収履歴（入金消込）の管理機能の実装。credit_logs コレクションの新設を検討。

セット料金の自動計算:

時間経過によるセット料金の自動加算ロジック（現在は手動入力または商品として追加）。

キャスト機能の拡充:

キャスト画面での「ヘルプ指名」や「通知機能」の実装検討。

以上の内容を前提として、開発サポートを継続してください。